---
Test
---

!2 Test Lagre loggmelding via REST-API, les tilbake

!include SetupServer

!3 1. Lagre loggmelding via REST-API

Meldingen 'Dette er meldingen' sendes som Base64-encodet tekst: 'RGV0dGUgZXIgbWVsZGluZ2Vu'

| !- Table:no.nav.sporingslogg.web.fitnesse.ServerRestFixture -! |
| jsonMelding | !- {"person":"12345678901", "mottaker":"123456789", "tema":"ABC", "behandlingsGrunnlag":"hjemmel1", "uthentingsTidspunkt":"2018-10-19T12:24:21.675", "leverteData":"RGV0dGUgZXIgbWVsZGluZ2Vu"} -! |
| POST | /sporingslogg/api/logg | 200 | Content-Type : application/json | | 


!3 2. Kall REST-tjenesten for å lese loggmelding, sjekk at returnert innhold er det som ble lagret (oidctoken må lages for bruker 12345678901)

For REST-STS i test kan token hentes ved GET til https://security-token-service.nais.preprod.local/rest/v1/sts/token?grant_type=client_credentials&scope=openid
med basic auth for bruker ('Basic c3J2QUJBQ1BFUDpoVUsxLjMwc0tocXAwLigy' for 12345678901)

| !- Table:no.nav.sporingslogg.web.fitnesse.ServerRestFixture -! |
| oidctoken | eyJraWQiOiJhZTUyMzFkMC1hYjA3LTRhZmEtYjk1Ny00MTUwODFjM2Q4M2MiLCJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJzcnZBQkFDUEVQIiwiYXVkIjpbInNydkFCQUNQRVAiLCJwcmVwcm9kLmxvY2FsIl0sInZlciI6IjEuMCIsIm5iZiI6MTU0NDYxNzk5MywiYXpwIjoic3J2QUJBQ1BFUCIsImlkZW50VHlwZSI6IlN5c3RlbXJlc3N1cnMiLCJhdXRoX3RpbWUiOjE1NDQ2MTc5OTMsImlzcyI6Imh0dHBzOlwvXC9zZWN1cml0eS10b2tlbi1zZXJ2aWNlLm5haXMucHJlcHJvZC5sb2NhbCIsImV4cCI6MTU0NDYyMTU5MywiaWF0IjoxNTQ0NjE3OTkzLCJqdGkiOiJiYjVmOGRkMy0wOGU1LTQ2MDItYjY1My01MzEyYjI1NGEwZmMifQ.CkfeGjSVPlPEnw7dl0bF1CXat04K_bW3iWvIjhXbNc73UudW-PFxjyRoc2Fir9SgEvuI_Dic8WQiSb62NOYZzPC3TM-vqaxDLvdN_zRTB0foHc-6406dTrPTOeN6szTbScgV_vi6VnfeyxfmYPLBsLuyVzo3wxeBHjyXGofJ8ILg6h7o2nJxzPoUy6ymjvblWJc16InlGNI60_8EwMZjT_W7qHqgqGFxJmsIf4bIYpD_e5JXJSHBB8ndaAaUZp-myFGNKN1OkI3Rylg2Asa-8WT6Mh9Ur9uQn2BYtwBJIL6HuB9m2L24WPdXG7-754Yrg6DAzMH8QIgR91-NwJbXDg |
| GET | /sporingslogg/api/les | 200 | Content-Type : application/json  |!- 
 jsonbody[0].person === "12345678901"
 jsonbody[0].mottaker === "123456789"
 jsonbody[0].tema === "ABC"
 jsonbody[0].behandlingsGrunnlag === "hjemmel1"
 jsonbody[0].uthentingsTidspunkt === "2018-10-19T12:24:21"
 jsonbody[0].leverteData === "RGV0dGUgZXIgbWVsZGluZ2Vu"
 -! | 
