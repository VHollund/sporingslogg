---
Test
---

!2 Test lagre loggmelding via Kafka


!3 1. Tøm databasen så andre tester ikke har påvirkning

| !- Table:no.nav.sporingslogg.web.fitnesse.LastDatabaseTabell -! | SPORINGS_LOGG |


!3 2. Legg loggmelding på Kafka topic

Meldingen 'Dette er meldingen' sendes som Base64-encodet tekst: 'RGV0dGUgZXIgbWVsZGluZ2Vu'

| script | no.nav.sporingslogg.web.fitnesse.LocalKafkaProducerFixture  |
| produce | !- {"person":"12345678901", "mottaker":"123456789", "tema":"ABC", "behandlingsGrunnlag":"hjemmel1", "uthentingsTidspunkt":"2018-10-19T12:24:21.675", "leverteData":"RGV0dGUgZXIgbWVsZGluZ2Vu"} -! |


!3 3. Vent litt så meldingen blir tatt og prosessert

| script | no.nav.sporingslogg.web.fitnesse.SleepFixture  |
| sleep seconds | 1 |

!3 4. Les innhold i databasen, sjekk at loggmeldingen er lagret der med forventede verdier

For ID vet vi ikke hvilken verdi vi forventer, bare at det er lagret en verdi
!define ikke_blank {=~/$/}

| !- Query:no.nav.sporingslogg.web.fitnesse.LesDatabaseTabell -! | SPORINGS_LOGG | |
| ID            | PERSON      | MOTTAKER  | TEMA | HJEMMEL  | TIDSPUNKT               | LEVERTE_DATA             |
| ${ikke_blank} | 12345678901 | 123456789 | ABC  | hjemmel1 | 2018-10-19 12:24:21.675000 | RGV0dGUgZXIgbWVsZGluZ2Vu |

